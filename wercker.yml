box: wercker/ruby
build:
  steps:
    - script:
        name: make ~/.ssh
        code: mkdir -p $HOME/.ssh
    - create-file:
        name: put private key
        filename: $HOME/.ssh/id_rsa
        overrite: true
        hide-from-log: true
        content: $SSH_KEY_PRIVATE
    - create-file:
        name: put tugboat config
        filename: $HOME/.tugboat
        overrite: true
        hide-from-log: true
        content: $TUGBOAT_CONFIG
    - script:
        name: install tugboat
        code: sudo gem install tugboat --no-ri --no-rdoc
    - script:
        name: create droplets
        code: tugboat create wercker-infrataster
    - script:
        name: wait droplets
        code: tugboat wait wercker-infrataster
    - script:
        name: get ip address
        code: export IPADDRESS=$(tugboat info wercker-infrataster | grep IP: | ruby -p -e 'sub(/.+?([\d\.]+)/, "\\1")')
    - script:
        name: show ip address
        code: echo $IPADDRESS


